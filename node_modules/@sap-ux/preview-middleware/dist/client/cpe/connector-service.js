'use strict';
sap.ui.define([
    'open/ux/preview/client/thirdparty/@sap-ux-private/control-property-editor-common',
    '../utils/version'
], function (___sap_ux_private_control_property_editor_common, ___utils_version) {
    'use strict';
    function __ui5_require_async(path) {
        return new Promise(function (resolve, reject) {
            sap.ui.require([path], function (module) {
                if (!(module && module.__esModule)) {
                    module = module === null || !(typeof module === 'object' && path.endsWith('/library')) ? { default: module } : module;
                    Object.defineProperty(module, '__esModule', { value: true });
                }
                resolve(module);
            }, function (err) {
                reject(err);
            });
        });
    }
    const storageFileChanged = ___sap_ux_private_control_property_editor_common['storageFileChanged'];
    const getUi5Version = ___utils_version['getUi5Version'];
    const isLowerThanMinimalUi5Version = ___utils_version['isLowerThanMinimalUi5Version'];
    class WorkspaceConnectorService {
        async init(sendAction) {
            if (isLowerThanMinimalUi5Version(await getUi5Version(), {
                    major: 1,
                    minor: 73
                })) {
                const FakeLrepConnector = (await __ui5_require_async('sap/ui/fl/FakeLrepConnector')).default;
                FakeLrepConnector.fileChangeRequestNotifier = notifier(sendAction);
            } else {
                const connector = (await __ui5_require_async('open/ux/preview/client/flp/WorkspaceConnector')).default;
                connector.storage.fileChangeRequestNotifier = notifier(sendAction);
            }
        }
    }
    function notifier(sendAction) {
        return (fileName, kind, changeType) => {
            if (changeType && changeType !== 'appdescr_fe_changePageConfiguration' || kind === 'delete') {
                sendAction(storageFileChanged(fileName?.replace('sap.ui.fl.', '')));
            }
        };
    }
    var __exports = { __esModule: true };
    __exports.WorkspaceConnectorService = WorkspaceConnectorService;
    return __exports;
});
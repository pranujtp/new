'use strict';
sap.ui.define(['open/ux/preview/client/thirdparty/@sap-ux-private/control-property-editor-common'], function (___sap_ux_private_control_property_editor_common) {
    'use strict';
    const setAppMode = ___sap_ux_private_control_property_editor_common['setAppMode'];
    const setUndoRedoEnablement = ___sap_ux_private_control_property_editor_common['setUndoRedoEnablement'];
    const setSaveEnablement = ___sap_ux_private_control_property_editor_common['setSaveEnablement'];
    const undo = ___sap_ux_private_control_property_editor_common['undo'];
    const redo = ___sap_ux_private_control_property_editor_common['redo'];
    const save = ___sap_ux_private_control_property_editor_common['save'];
    class RtaService {
        constructor(rta) {
            this.rta = rta;
        }
        init(sendAction, subscribe) {
            subscribe(async action => {
                if (setAppMode.match(action)) {
                    this.rta.setMode(action.payload);
                }
                if (undo.match(action)) {
                    this.rta.undo();
                }
                if (redo.match(action)) {
                    this.rta.redo();
                }
                if (save.match(action)) {
                    if (this.rta.save) {
                        this.rta.save();
                    } else {
                        this.rta?._serializeToLrep();
                    }
                }
                return Promise.resolve();
            });
            this.rta.attachModeChanged(modeAndStackChangeHandler(sendAction, this.rta));
        }
    }
    function modeAndStackChangeHandler(sendAction, rta) {
        return () => {
            const canUndo = rta.canUndo();
            const canRedo = rta.canRedo();
            const saveAllowed = rta?.canSave ? rta?.canSave() : canUndo;
            sendAction(setUndoRedoEnablement({
                canUndo,
                canRedo
            }));
            sendAction(setSaveEnablement(saveAllowed));
        };
    }
    var __exports = { __esModule: true };
    __exports.RtaService = RtaService;
    __exports.modeAndStackChangeHandler = modeAndStackChangeHandler;
    return __exports;
});